# テスト駆動開発 (TDD) の基本

## 基本概念

テスト駆動開発（TDD）は、以下のサイクルで進める開発手法です：

1. **Red:**  
   まず、失敗するテストケースを書いて、実装すべき仕様を明確にします。
2. **Green:**  
   テストが通るように、最小限の実装を行います。
3. **Refactor:**  
   コードをリファクタリングして改善し、読みやすさや保守性を向上させます。

## 重要な考え方

- **テストは仕様である:**  
  テストコードは、実装すべき仕様そのものとして扱います。テストケースを見るだけで、どのような挙動が求められているかが分かるようにします。

- **Assert-Act-Arrange の順序で考える:**  
  テストコードの記述順序を次のように意識してください：
  1. **Assert（期待結果）:**  
     最初に期待する結果を定義します。
  2. **Act（操作）:**  
     次にテスト対象の処理を実行します。
  3. **Arrange（準備）:**  
     最後にテスト環境のセットアップや必要な準備コードを記述します。

  ※ 実際の実行順序は Arrange → Act → Assert ですが、実装の際は期待結果から始めることで、目的を明確にしてコードを書き進められます。

- **テスト名は「状況→操作→結果」の形式で記述:**  
  例：  
  「有効なトークンの場合にユーザー情報を取得すると成功すること」  
  「無効なトークンの場合にエラーが返されること」

## リファクタリングフェーズの重要ツール

テストが通った後のリファクタリングフェーズでは、以下のツールを活用してください：

1. **静的解析・型チェック:**
   - `mypy .`  
     型チェックを行い、型安全性を確認します。
   - `ruff .`
     コード品質とスタイルのチェックを実施します。

2. **デッドコード検出・削除:**
   - [vulture](https://pypi.org/project/vulture/) を使用して、未使用の関数やエクスポートを定期的に検出し、必要に応じて削除します。

3. **コードカバレッジ測定:**
   - `pytest --cov=.` を使用してテストカバレッジを計測し、coverage.py でレポートを確認します。
     ```bash
     pytest --cov=.  # テストを実行しカバレッジレポートを生成
     coverage report  # カバレッジの概要を表示
     ```
   
4. **Git によるバージョン管理:**
   - 各フェーズ（テスト作成→実装→リファクタリング）の完了時に、変更内容を Git にコミットします。  
   - タスク完了時にユーザーに確認してから、以下のコマンドでコミットを実行します：
     ```bash
     git status  # 変更状態を確認
     git add <関連ファイル>
     git commit -m "<適切なコミットメッセージ>"
     ```
   - コミットメッセージは以下のプレフィックスを使い分けます：
     - `test:` - テストの追加・修正
     - `feat:` - 新機能の実装
     - `fix:` - バグ修正
     - `refactor:` - リファクタリング
     - `docs:` - ドキュメントの更新
     - `chore:` - ビルドプロセスやツールの変更

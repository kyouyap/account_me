---
name: Python:Module
groups:
  - read
  - edit
  - browser
  - command
  - mcp
source: "project"
---

## 実装モード: モジュールモード

本モジュールは、複数ファイルで構成されるパッケージにおいて、内部実装と公開 API を明確に分離することを目的とします。Python の設計思想に則り、依存関係は必要な箇所で直接インポートし、シンプルかつ明示的な構造により可読性とメンテナンス性を向上させます。

### 例: ディレクトリ構成

```
xxx/                     # パッケージ xxx
  __init__.py           # 公開 API を定義。必要なクラス・関数のみを再エクスポート。
  core.py               # 中核となる実装コード。必要に応じた型定義や定数も内包。
  utils.py              # 内部処理を支える補助関数群を実装。
tests/                   # テストコードの集約ディレクトリ
  test_core.py          # core.py の機能に対するテスト
  test_utils.py         # utils.py の機能に対するテスト
```

### 各ファイルの役割

- **`__init__.py`:**  
  - パッケージのパブリック API を明示的に定義します。  
  - 内部実装（`core.py` や `utils.py`）から公開すべきシンボルのみをインポートし、`__all__` に登録します。  
  - これにより、他モジュールは必ずこのファイル経由で機能へアクセスし、内部構造の詳細は隠蔽されます。

- **`core.py`:**  
  - パッケージの主要な実装コードを担当します。  
  - 外部依存ライブラリはファイル内で直接インポートし、必要に応じて PEP 484 に基づく型ヒントを使用します。  
  - 複雑な型定義や定数は、このファイル内にまとめるか、必要であれば小規模なサブモジュールに分割します。

- **`utils.py`:**  
  - `core.py` を補完する補助関数や内部処理機能を実装します。  
  - 単一責任の原則に従い、関連する機能をシンプルなユーティリティとして提供します。

- **テストファイル (`tests/` 以下):**  
  - 各実装ファイルに対応するテストコードを、パッケージルートから独立して管理します。  
  - テストは `pytest` を活用し、機能ごとに分割されたテストファイルを用いることで、効率的なデバッグとリファクタリングを実現します。  
  - 例:
    ```bash
    pytest --maxfail=1 --disable-warnings -q
    ```

### テストの実行とデバッグ

- **モジュール全体のテスト実行例:**
  ```bash
  pytest --maxfail=1 --disable-warnings -q
  ```
- **特定のテストファイル実行例:**
  ```bash
  pytest tests/test_core.py
  ```
- **テスト失敗時の対処手順:**
  1. 全体テストの実行で問題箇所を特定する。  
  2. 該当テストファイルを個別に実行し、段階的に原因を特定（例: プリントデバッグを併用）する。  
  3. 修正後、再度全体テストを実行して動作を確認する。

### 依存管理と外部参照

- 外部ライブラリは `pip`、`poetry`、`pyproject.toml`、または `requirements.txt` で管理します。  
- 他パッケージや外部ライブラリへの参照は、絶対インポートまたは明示的な相対インポートを使用し、内部実装の変更が外部へ影響しない設計とします。  
- 例：  
  - **OK:**  
    ```python
    from requests import get
    ```
  - **NG:**  
    ```python
    from some_internal_path.requests import get
    ```

このような設計により、モジュール間の依存関係が明確になり、リファクタリングやコードメンテナンスが容易になります。Python の哲学に基づいたシンプルで明示的な構造は、長期的なプロジェクトの品質向上に寄与します。
